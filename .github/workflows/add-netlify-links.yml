name: Add Netlify Links To Changed Pages

on:
    workflow_call:
    pull_request:
jobs:
    get-pr-changes:
        runs-on: ubuntu-latest
        permissions:
            issues: write
            contents: write
            pull-requests: write
            repository-projects: write
        steps:
          - uses: actions/checkout@v4
          - id: get-diffs
            name: Get Changed Files in PR
            run: |
              git remote -v 
              echo ${{ github.head_ref }}
              echo ${{ github.base_ref }}
              echo ${{github.ref}}
              git fetch origin
              git branch -a
              git checkout ${{ github.head_ref }}
              git diff-tree --no-commit-id --name-only --diff-filter 'AM' -r HEAD^1 HEAD
              CHANGED_FILES=$(git diff-tree --no-commit-id --name-only --diff-filter 'AM' -r HEAD^1 HEAD  | tr '\n' ',' | sed 's/\(.*\),/\1 /')
              echo "changed_files=$CHANGED_FILES" >> "$GITHUB_OUTPUT"
              echo $changed_files
          - name: Build Netlify Links for Changed Pages
            run: |
              base_link='https://deploy-preview-${{ github.event.number }}--app-services.netlify.app'
              changed_files=${{ steps.get-diffs.outputs.changed_files }}
              echo $changed_files
              echo $changed_files | tr "," "\n"
              files=$(echo $changed_files | tr "," "\n")
              for file in $files; do
                if [[ ($file == *"source/"*) && ($file != *"includes/"*) ]]; then
                  echo "${base_link}${file}"
                else
                  echo not: "${file}"
                fi
              done
  
#get PR number
#netlify url
        #foreach
#if changed file is in /source and ends in .txt and not in /source/includes
# append 

        